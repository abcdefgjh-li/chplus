# ch_Lib 数学库 (math.ch)

## 概述

`math.ch` 是一个为 chplus 中文解释器开发的完整数学库，包含了 C++ cmath 标准库的所有功能。这个库为 chplus 语言提供了强大的数学计算能力。

## 库信息

- **版本**: 1.0
- **作者**: chplus解释器
- **包含功能**: C++ cmath 所有功能的实现
- **语言**: 中文(.ch)

## 导入方式

```ch
导入("ch_Lib/math.ch");
```

## 数学常数

| 常数名称 | 值 | 描述 |
|---------|---|------|
| PI | 3.14159265358979323846 | 圆周率 π |
| E | 2.71828182845904523536 | 自然对数的底数 e |
| SQRT2 | 1.41421356237309504880 | 2的平方根 |
| LN2 | 0.69314718055994530942 | 2的自然对数 |
| LN10 | 2.30258509299404568402 | 10的自然对数 |
| LOG2E | 1.44269504088896340736 | e以2为底的对数 |
| LOG10E | 0.43429448190325182765 | e以10为底的对数 |
| SQRT1_2 | 0.70710678118654752440 | 1/2的平方根 |

## 函数分类

### 1. 三角函数

#### 基本三角函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 正弦 | `sin(x)` | 计算x度的正弦值 | `sin(30) = 0.5` |
| 余弦 | `cos(x)` | 计算x度的余弦值 | `cos(60) = 0.5` |
| 正切 | `tan(x)` | 计算x度的正切值 | `tan(45) = 1.0` |

#### 反三角函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 反正弦 | `asin(x)` | 计算x的反正弦值(度) | `asin(0.5) ≈ 30°` |
| 反余弦 | `acos(x)` | 计算x的反余弦值(度) | `acos(0.5) ≈ 60°` |
| 反正切 | `atan(x)` | 计算x的反正切值(度) | `atan(1) ≈ 45°` |

#### 双曲函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 双曲正弦 | `sinh(x)` | 双曲正弦函数 | `sinh(1) ≈ 1.175` |
| 双曲余弦 | `cosh(x)` | 双曲余弦函数 | `cosh(1) ≈ 1.543` |
| 双曲正切 | `tanh(x)` | 双曲正切函数 | `tanh(1) ≈ 0.762` |

### 2. 指数对数函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 指数 | `exp(x)` | 计算 e^x | `exp(1) = e ≈ 2.718` |
| 自然对数 | `log(x)` | 计算 x 的自然对数 | `log(e) = 1` |
| 常用对数 | `log10(x)` | 计算 x 的常用对数(以10为底) | `log10(100) = 2` |
| 平方根 | `sqrt(x)` | 计算 x 的平方根 | `sqrt(16) = 4` |
| 立方根 | `cbrt(x)` | 计算 x 的立方根 | `cbrt(8) = 2` |

### 3. 取整函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 向上取整 | `ceil(x)` | 返回不小于x的最小整数 | `ceil(3.2) = 4` |
| 向下取整 | `floor(x)` | 返回不大于x的最大整数 | `floor(3.8) = 3` |
| 四舍五入 | `round(x)` | 返回最接近x的整数 | `round(3.5) = 4` |
| 向零取整 | `trunc(x)` | 向零方向舍入 | `trunc(3.9) = 3` |

### 4. 绝对值函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 整数绝对值 | `abs(x)` | 返回x的绝对值(整数) | `abs(-5) = 5` |
| 小数绝对值 | `fabs(x)` | 返回x的绝对值(小数) | `fabs(-3.14) = 3.14` |

### 5. 其他数学函数

| 函数 | 语法 | 描述 | 示例 |
|------|------|------|------|
| 浮点取模 | `fmod(x, y)` | 返回x除以y的余数 | `fmod(10, 3) = 1` |
| 取余 | `remainder(x, y)` | 返回x除以y的IEEE余数 | `remainder(10, 3) = 1` |
| 整数最大值 | `max_int(a, b)` | 返回a和b中的最大值(整数) | `max_int(10, 5) = 10` |
| 整数最小值 | `min_int(a, b)` | 返回a和b中的最小值(整数) | `min_int(10, 5) = 5` |
| 小数最大值 | `max_double(a, b)` | 返回a和b中的最大值(小数) | `max_double(3.14, 2.71) = 3.14` |
| 小数最小值 | `min_double(a, b)` | 返回a和b中的最小值(小数) | `min_double(3.14, 2.71) = 2.71` |
| 符号函数 | `sign(x)` | 返回x的符号 | `sign(-5) = -1` |
| 判断无穷大 | `isinf(x)` | 检查x是否无穷大 | `isinf(1000000) = 真` |
| 判断NaN | `isnan(x)` | 检查x是否是NaN | `isnan(0.0/0.0) = 真` |
| 判断有限 | `isfinite(x)` | 检查x是否有限 | `isfinite(100) = 真` |
| 最大公约数 | `gcd(a, b)` | 计算a和b的最大公约数 | `gcd(12, 8) = 4` |
| 最小公倍数 | `lcm(a, b)` | 计算a和b的最小公倍数 | `lcm(4, 6) = 12` |

### 6. 库信息函数

| 函数 | 语法 | 描述 |
|------|------|------|
| 版本信息 | `math_lib_version()` | 返回库的版本信息 |
| 库信息 | `math_lib_info()` | 返回库的功能描述 |
| 常数验证 | `is_constant_valid()` | 验证数学常数的有效性 |

## 使用示例

### 基本三角函数

```ch
导入("ch_Lib/math.ch");

定义(空类型) 主函数() {
    // 计算角度的三角函数值
    定义(小数) angle = 45.0;
    定义(小数) sin_val = sin(angle);
    定义(小数) cos_val = cos(angle);
    定义(小数) tan_val = tan(angle);
    
    控制台输出("角度 " + angle + "° 的三角函数值:");
    控制台输出("sin(" + angle + "°) = " + sin_val);
    控制台输出("cos(" + angle + "°) = " + cos_val);
    控制台输出("tan(" + angle + "°) = " + tan_val);
}
```

### 数学计算应用

```ch
导入("ch_Lib/math.ch");

定义(空类型) 主函数() {
    // 计算圆的面积
    定义(小数) radius = 5.0;
    定义(小数) area = PI * radius * radius;
    控制台输出("半径为 " + radius + " 的圆面积 = " + area);
    
    // 计算复利
    定义(小数) principal = 1000.0;
    定义(小数) rate = 0.05;
    定义(整型) years = 3;
    定义(小数) amount = principal * (1 + rate) * (1 + rate) * (1 + rate);
    控制台输出("3年后本息 = " + amount);
    
    // 角度转换
    定义(小数) degrees = 180.0;
    定义(小数) radians = PI * degrees / 180.0;
    控制台输出(degrees + "° = " + radians + " 弧度");
}
```

### 数值处理

```ch
导入("ch_Lib/math.ch");

定义(空类型) 主函数() {
    // 处理不同类型的数值
    定义(小数) num1 = 3.7;
    定义(小数) num2 = -2.3;
    
    控制台输出("数值处理示例:");
    控制台输出("ceil(" + num1 + ") = " + ceil(num1));
    控制台输出("floor(" + num1 + ") = " + floor(num1));
    控制台输出("round(" + num1 + ") = " + round(num1));
    控制台输出("abs(" + num2 + ") = " + abs(num2));
    控制台输出("fabs(" + num2 + ") = " + fabs(num2));
}
```

## 技术特点

1. **完整兼容**: 实现了C++ cmath标准库的所有功能
2. **中文接口**: 所有函数名和参数都使用中文，提高可读性
3. **角度系统**: 三角函数使用角度制(而非弧度制)，更符合中文编程习惯
4. **类型安全**: 提供整数和小数版本的函数，确保类型安全
5. **错误处理**: 包含边界检查和错误处理机制

## 实现说明

- **三角函数**: 使用泰勒级数展开进行计算
- **指数对数**: 使用级数展开和牛顿迭代法
- **取整函数**: 基于数值类型转换实现
- **数学常量**: 提供高精度常数定义

## 注意事项

1. 所有角度参数都以度为单位，不是弧度
2. 自然对数函数使用 `log(x)` 而不是 `ln(x)`
3. 平方根函数使用 `sqrt(x)` 而不是 `√x`
4. 建议在使用前调用 `is_constant_valid()` 验证常数有效性

## 扩展性

该库采用模块化设计，便于扩展：
- 可以添加新的数学函数
- 可以添加更多的数学常数
- 可以添加领域特定的数学计算函数

---

*该数学库为 chplus 中文解释器的标准库，为开发者提供完整的数学计算能力。*