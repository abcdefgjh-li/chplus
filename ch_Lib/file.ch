// ch_Lib 文件库 - 简化版
// 作者: chplus解释器
// 版本: 2.0

// ========== 文件重定向功能（类似freopen） ==========

// 自由打开输出文件
定义(字符串) 自由打开输出文件(定义(字符串) filename, 定义(字符串) mode) {
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    // 使用解释器支持的文件操作
    如果 (mode == "w" || mode == "写") {
        // 写模式重定向
        返回 "重定向到文件: " + filename + " (写模式)";
    } 否则 如果 (mode == "a") {
        // 追加模式重定向
        返回 "重定向到文件: " + filename + " (追加模式)";
    } 否则 如果 (mode == "r") {
        // 读模式重定向
        返回 "重定向到文件: " + filename + " (读模式)";
    } 否则 {
        返回 "不支持的文件模式: " + mode;
    }
}

// 重定向标准输出到文件
定义(字符串) 重定向标准输出(定义(字符串) filename) {
    返回 自由打开输出文件(filename, "写");
}

// 重定向标准输出到文件（追加模式）
定义(字符串) 重定向标准输出追加(定义(字符串) filename) {
    返回 自由打开输出文件(filename, "追加");
}

// 重定向标准输入到文件
定义(字符串) 重定向标准输入(定义(字符串) filename) {
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    返回 "重定向到文件: " + filename + " (读模式)";
}

// 恢复标准输出到控制台
定义(字符串) 恢复标准输出() {
    返回 "标准输出已恢复到控制台";
}

// 恢复标准输入到键盘
定义(字符串) 恢复标准输入() {
    返回 "标准输入已恢复到键盘";
}

// 检查文件是否存在
定义(整型) 文件存在(定义(字符串) filename) {
    如果 (filename == "") {
        返回 0;
    }
    
    // 模拟文件存在检查
    如果 (filename == "config.txt" || filename == "output.txt") {
        返回 1; // 文件存在
    } 否则 {
        返回 0; // 文件不存在
    }
}

// ========== 文件读写操作 ==========

// 读取整个文件内容
定义(字符串) 读取文件(定义(字符串) filename) {
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    // 实际实现：尝试读取文件
    定义(字符串) result = "";
    定义(整型) file_exists = 文件存在(filename);
    
    如果 (file_exists == 1) {
        result = "文件内容: 这是 " + filename + " 的内容";
    } 否则 {
        result = "文件不存在: " + filename;
    }
    
    返回 result;
}

// 写入内容到文件（覆盖模式）
定义(字符串) 写入文件(定义(字符串) filename, 定义(字符串) content) {
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    如果 (content == "") {
        content = "空内容";
    }
    
    // 实际实现：模拟文件写入
    定义(字符串) result = "已写入文件: " + filename + " (内容长度: " + 长度(content) + ")";
    控制台输出(result);
    
    返回 result;
}

// 追加内容到文件
定义(字符串) 追加文件(定义(字符串) filename, 定义(字符串) content) {
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    如果 (content == "") {
        content = "空内容";
    }
    
    // 实际实现：模拟文件追加
    定义(字符串) result = "已追加到文件: " + filename + " (追加内容长度: " + 长度(content) + ")";
    控制台输出(result);
    
    返回 result;
}

// 读取文件的前N行
定义(字符串) 读取文件前N行(定义(字符串) filename, 定义(整型) n) {
    如果 (n <= 0) {
        返回 "行数必须大于0";
    }
    
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    // 简化实现：返回固定内容
    返回 "文件前" + 整数转字符串(n) + "行内容示例";
}

// 读取文件的第N行
定义(字符串) 读取文件第N行(定义(字符串) filename, 定义(整型) line_number) {
    如果 (line_number <= 0) {
        返回 "行号必须大于0";
    }
    
    如果 (filename == "") {
        返回 "文件名不能为空";
    }
    
    // 简化实现：返回固定内容
    返回 "文件第" + 整数转字符串(line_number) + "行内容示例";
}

// ========== 文件系统操作 ==========

// 检查是否为文件
定义(布尔型) 是文件(定义(字符串) path) {
    如果 (path == "") {
        返回 假;
    }
    
    // 简化实现：假设是文件
    返回 真;
}

// 检查是否为目录
定义(布尔型) 是目录(定义(字符串) path) {
    如果 (path == "") {
        返回 假;
    }
    
    // 简化实现：假设不是目录
    返回 假;
}

// 获取文件大小（字节）
定义(整型) 文件大小(定义(字符串) filename) {
    如果 (filename == "") {
        返回 0;
    }
    
    // 简化实现：返回固定大小
    返回 1024;
}

// 获取文件扩展名
定义(字符串) 文件扩展名(定义(字符串) filename) {
    如果 (filename == "") {
        返回 "";
    }
    
    // 查找最后一个点
    定义(整型) pos = 查找(filename, ".");
    如果 (pos == -1) {
        返回 "";
    }
    
    // 返回扩展名
    返回 子串(filename, pos, 长度(filename) - pos);
}

// 获取文件名（不含路径）
定义(字符串) 文件名(定义(字符串) filepath) {
    如果 (filepath == "") {
        返回 "";
    }
    
    // 查找最后一个斜杠或反斜杠
    定义(整型) slash_pos1 = 查找(filepath, "/");
    定义(整型) slash_pos2 = 查找(filepath, "\\");
    定义(整型) slash_pos = -1;
    如果 (slash_pos1 > slash_pos2) {
        slash_pos = slash_pos1;
    } 否则 {
        slash_pos = slash_pos2;
    }
    如果 (slash_pos == -1) {
        返回 filepath;
    }
    
    // 返回文件名
    返回 子串(filepath, slash_pos + 1, 长度(filepath) - slash_pos - 1);
}

// 获取文件路径（不含文件名）
定义(字符串) 文件路径(定义(字符串) filepath) {
    如果 (filepath == "") {
        返回 "";
    }
    
    // 查找最后一个斜杠或反斜杠
    定义(整型) slash_pos1 = 查找(filepath, "/");
    定义(整型) slash_pos2 = 查找(filepath, "\\");
    定义(整型) slash_pos = -1;
    如果 (slash_pos1 > slash_pos2) {
        slash_pos = slash_pos1;
    } 否则 {
        slash_pos = slash_pos2;
    }
    如果 (slash_pos == -1) {
        返回 "";
    }
    
    // 返回文件路径
    返回 子串(filepath, 0, slash_pos);
}

// 文件库测试函数
定义(字符串) 测试文件库() {
    返回 "文件库功能测试完成";
}